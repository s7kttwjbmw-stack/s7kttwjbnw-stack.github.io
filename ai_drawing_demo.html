<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›å…´ç²¾å¯† - AIå›¾çº¸æ™ºèƒ½è¯†åˆ«ä¸æ‹†è§£ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- å¼•å…¥Fabric.jsç”¨äºäº¤äº’å¼å›¾çº¸æ ‡æ³¨ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 1300px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1); overflow: hidden; }
        header { background: linear-gradient(90deg, #1a2980, #26d0ce); color: white; padding: 30px; text-align: center; }
        header h1 { font-size: 2.8em; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 15px; }
        .pain-points { background: #fff8e1; padding: 15px; margin: 20px; border-radius: 10px; border-left: 5px solid #ffb300; font-size: 0.95em; }
        .content { display: flex; flex-wrap: wrap; padding: 25px; gap: 25px; }
        .panel { background: #f9f9f9; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .left-panel { flex: 1; min-width: 320px; }
        .right-panel { flex: 2; min-width: 500px; }
        h2 { color: #1a2980; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #eaeaea; }
        .upload-area { border: 3px dashed #26d0ce; border-radius: 15px; padding: 40px 20px; text-align: center; background: #f0fdff; cursor: pointer; transition: all 0.3s; margin-bottom: 25px; }
        .upload-area:hover { background: #e0f7fa; border-color: #1a9988; }
        #fileInput { display: none; }
        .btn { background: linear-gradient(90deg, #1a2980, #26d0ce); color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 1.1em; font-weight: bold; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; transition: all 0.2s; margin: 10px 5px; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 7px 15px rgba(38, 208, 206, 0.4); }
        .btn-reset { background: linear-gradient(90deg, #757575, #9e9e9e); }
        .tabs { display: flex; border-bottom: 2px solid #eaeaea; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 12px 25px; cursor: pointer; border-radius: 10px 10px 0 0; font-weight: bold; color: #666; transition: all 0.3s; }
        .tab.active { background: #1a2980; color: white; }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .result-box { background: white; border-radius: 10px; padding: 20px; border: 1px solid #ddd; max-height: 500px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #1a2980; color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        tr:hover { background-color: #f5f5f5; }
        .status-bar { background: #e8f5e9; padding: 12px; border-radius: 10px; margin: 20px 0; border-left: 5px solid #4caf50; }
        .loading { display: none; text-align: center; padding: 20px; }
        .spinner { border: 5px solid #f3f3f3; border-top: 5px solid #26d0ce; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* é›¶ä»¶å›¾çº¸æ ‡æ³¨åŒºåŸŸç‰¹æœ‰æ ·å¼ */
        .canvas-container { border: 1px solid #ccc; border-radius: 10px; margin-top: 15px; overflow: auto; max-height: 500px; background: #fafafa; text-align: center; }
        #drawingCanvas { max-width: 100%; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .canvas-controls { display: flex; justify-content: center; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
        .canvas-controls .btn { padding: 10px 20px; font-size: 0.9em; }
        .part-list-sidebar { max-height: 400px; overflow-y: auto; margin-top: 15px; padding: 10px; border: 1px solid #eaeaea; border-radius: 10px; }
        .part-item { padding: 8px 12px; margin-bottom: 8px; background: #f1f8ff; border-left: 4px solid #1a2980; cursor: pointer; border-radius: 5px; transition: all 0.3s; }
        .part-item:hover { background: #e3f2fd; transform: translateX(5px); }
        .highlight { color: #d32f2f; font-weight: bold; }
        .success { color: #388e3c; }
        footer { text-align: center; padding: 20px; color: #777; font-size: 0.9em; border-top: 1px solid #eee; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-robot"></i> åˆ›å…´ç²¾å¯† - AIå›¾çº¸æ™ºèƒ½è¯†åˆ«ä¸æ‹†è§£ç³»ç»Ÿ</h1>
            <p>é’ˆå¯¹â€œå°æ‰¹é‡ã€å¤šå“ç§ã€éæ ‡å®šåˆ¶â€ç”Ÿäº§ç—›ç‚¹çš„ä¸€ç«™å¼æ™ºèƒ½è§£å†³æ–¹æ¡ˆ</p>
        </header>
        <div class="pain-points">
            <strong>ğŸ” ç›´å‡»ä¼ä¸šæ ¸å¿ƒç—›ç‚¹ï¼š</strong> è®¢å•å“åº”æ…¢ | é«˜åº¦ä¾èµ–äººå·¥ç»éªŒæ‹†å›¾ | æ•°æ®å­¤å²›ç®¡ç†å›°éš¾ | è®¢å•ä¼˜å…ˆçº§æ··ä¹±
        </div>
        <div class="content">
            <!-- å·¦ä¾§é¢æ¿ï¼šä¸Šä¼ ä¸æ§åˆ¶åŒº -->
            <div class="left-panel panel">
                <h2><i class="fas fa-cloud-upload-alt"></i> 1. å›¾çº¸ä¸Šä¼ </h2>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-file-import fa-3x"></i>
                    <h3>ç‚¹å‡»æˆ–æ‹–æ”¾ä¸Šä¼ å›¾çº¸</h3>
                    <p>æ”¯æŒæ ¼å¼ï¼šJPG, PNG, PDF, DXF, DWG</p>
                    <input type="file" id="fileInput" accept="image/*">
                </div>
                <p id="fileName" style="text-align:center; margin-bottom:20px; color:#666;">æœªé€‰æ‹©æ–‡ä»¶</p>
                <h2><i class="fas fa-cogs"></i> 2. AIåˆ†ææ§åˆ¶</h2>
                <div style="text-align: center;">
                    <button class="btn" onclick="startAnalysis()"><i class="fas fa-play-circle"></i> å¯åŠ¨AIæ™ºèƒ½è¯†åˆ«ä¸æ‹†è§£</button>
                    <button class="btn btn-reset" onclick="resetAll()"><i class="fas fa-redo"></i> é‡ç½®ç³»ç»Ÿ</button>
                </div>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>AIå¼•æ“æ­£åœ¨å·¥ä½œï¼šè¯†åˆ«é›¶ä»¶è½®å»“ Â· è§£æå°ºå¯¸æ ‡æ³¨ Â· åŒ¹é…å·¥è‰ºåº“ Â· ç”ŸæˆBOM...</p>
                </div>
                <div class="status-bar" id="statusBar">
                    <i class="fas fa-info-circle success"></i>
                    <span>ç³»ç»Ÿå°±ç»ªã€‚è¯·ä¸Šä¼ å›¾çº¸å¹¶å¯åŠ¨åˆ†æã€‚</span>
                </div>
                <h2><i class="fas fa-lightbulb"></i> 3. æ–¹æ¡ˆæ ¸å¿ƒä»·å€¼</h2>
                <ul style="line-height: 1.8; padding-left: 20px;">
                    <li><strong>æ•ˆç‡æå‡</strong>ï¼šå°†æ•°å°æ—¶çš„æ‹†å›¾æŠ¥ä»·æµç¨‹ç¼©çŸ­è‡³ <span class="highlight">æ•°åˆ†é’Ÿ</span>ã€‚</li>
                    <li><strong>ç»éªŒå›ºåŒ–</strong>ï¼šå°†èµ„æ·±å·¥ç¨‹å¸ˆç»éªŒè½¬åŒ–ä¸ºAIæ¨¡å‹ï¼Œé™ä½å¯¹äººä¾èµ–ã€‚</li>
                    <li><strong>æ•°æ®æ‰“é€š</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–BOMï¼Œä¸ºERP/MESç³»ç»Ÿæä¾›æ•°æ®æºã€‚</li>
                    <li><strong>å†³ç­–æ”¯æŒ</strong>ï¼šä¸ºè®¢å•ä¼˜å…ˆçº§æ’åºæä¾›é‡åŒ–ä¾æ®ï¼ˆäº¤æœŸã€åˆ©æ¶¦ã€å®¢æˆ·ç­‰çº§ï¼‰ã€‚</li>
                </ul>
            </div>
            <!-- å³ä¾§é¢æ¿ï¼šç»“æœæ˜¾ç¤ºåŒº -->
            <div class="right-panel panel">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab(0)"><i class="fas fa-clipboard-list"></i> æ‹†è§£æŠ¥å‘Š</div>
                    <div class="tab" onclick="switchTab(1)"><i class="fas fa-project-diagram"></i> é›¶ä»¶å›¾çº¸</div>
                    <div class="tab" onclick="switchTab(2)"><i class="fas fa-cogs"></i> é›¶ä»¶æ¸…å• (BOM)</div>
                    <div class="tab" onclick="switchTab(3)"><i class="fas fa-chart-line"></i> æ•ˆç›Šåˆ†æ</div>
                </div>
                <!-- æ ‡ç­¾é¡µ1ï¼šæ‹†è§£æŠ¥å‘Š -->
                <div class="tab-content active" id="tab1">
                    <h3>AIåˆ†ææ€»è§ˆæŠ¥å‘Š</h3>
                    <div class="result-box">
                        <div id="reportContent">
                            <p>æŠ¥å‘Šå°†åœ¨AIåˆ†æåç”Ÿæˆã€‚ä»¥ä¸‹æ˜¯æ¨¡æ‹Ÿæ•°æ®ç¤ºä¾‹ï¼š</p>
                            <ul>
                                <li><strong>é¡¹ç›®åç§°</strong>ï¼šç”Ÿç‰©è´¨ç‡ƒçƒ§æœºå¤–å£³ç»„ä»¶</li>
                                <li><strong>è®¢å•å·</strong>ï¼šORD20250315</li>
                                <li><strong>AIè¯†åˆ«çŠ¶æ€</strong>ï¼š<span class="success">å¾…åˆ†æ</span></li>
                                <li><strong>è¯†åˆ«é›¶ä»¶æ€»æ•°</strong>ï¼š--</li>
                                <li><strong>æ€»é‡é‡ä¼°ç®—</strong>ï¼š--</li>
                                <li><strong>æ€»å·¥æ—¶ä¼°ç®—</strong>ï¼š--</li>
                                <li><strong>ææ–™æˆæœ¬ä¼°ç®—</strong>ï¼š--</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- æ ‡ç­¾é¡µ2ï¼šé›¶ä»¶å›¾çº¸ (äº¤äº’å¼æ ‡æ³¨) -->
                <div class="tab-content" id="tab2">
                    <h3><i class="fas fa-cube"></i> AIæ‹†è§£é›¶ä»¶å¯è§†åŒ–</h3>
                    <p>ç³»ç»Ÿå·²è‡ªåŠ¨è¯†åˆ«å¹¶æ¡†é€‰å‡ºä¸»è¦é›¶ä»¶ã€‚ç‚¹å‡»å³ä¾§åˆ—è¡¨å¯é«˜äº®å¯¹åº”é›¶ä»¶ï¼Œæ”¯æŒå›¾çº¸æ ‡æ³¨å¯¼å‡ºã€‚</p>
                    <div class="canvas-controls">
                        <button class="btn" onclick="highlightPart('part1')"><i class="fas fa-search"></i> é«˜äº®é¢æ¿</button>
                        <button class="btn" onclick="highlightPart('part2')"><i class="fas fa-search"></i> é«˜äº®ä¾§æ¿</button>
                        <button class="btn" onclick="resetHighlight()"><i class="fas fa-sync-alt"></i> é‡ç½®é«˜äº®</button>
                        <button class="btn" onclick="downloadMarkedDrawing()"><i class="fas fa-download"></i> ä¸‹è½½æ ‡æ³¨å›¾çº¸</button>
                    </div>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div style="flex: 3; min-width: 300px;">
                            <div class="canvas-container">
                                <canvas id="drawingCanvas" width="800" height="600"></canvas>
                            </div>
                        </div>
                        <div style="flex: 1; min-width: 250px;">
                            <h4><i class="fas fa-list-ol"></i> é›¶ä»¶åˆ—è¡¨</h4>
                            <div class="part-list-sidebar" id="partList">
                                <!-- é›¶ä»¶åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                <h5><i class="fas fa-info-circle"></i> ä½¿ç”¨è¯´æ˜</h5>
                                <p><small>1. å·¦ä¾§ç”»å¸ƒå±•ç¤ºäº†AIè‡ªåŠ¨è¯†åˆ«çš„é›¶ä»¶è¾¹ç•Œã€‚<br>2. ç‚¹å‡»åˆ—è¡¨æˆ–æŒ‰é’®å¯é«˜äº®ç‰¹å®šé›¶ä»¶ã€‚<br>3. å¯ä½¿ç”¨â€œä¸‹è½½â€åŠŸèƒ½å¯¼å‡ºæ ‡æ³¨å›¾çº¸ï¼Œç”¨äºç”Ÿäº§æŒ‡å¯¼ã€‚</small></p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- æ ‡ç­¾é¡µ3ï¼šé›¶ä»¶æ¸…å• (BOM) -->
                <div class="tab-content" id="tab3">
                    <h3>é›¶ä»¶æ˜ç»†è¡¨ (Bill of Materials)</h3>
                    <div class="result-box">
                        <table id="partsTable">
                            <thead><tr><th>åºå·</th><th>é›¶ä»¶åç§°</th><th>æè´¨</th><th>åšåº¦</th><th>å°ºå¯¸(mm)</th><th>æ¨èå·¥è‰º</th><th>æ•°é‡</th></tr></thead>
                            <tbody><tr><td colspan="7" style="text-align:center;">æ•°æ®åŠ è½½ä¸­...</td></tr></tbody>
                        </table>
                    </div>
                </div>
                <!-- æ ‡ç­¾é¡µ4ï¼šæ•ˆç›Šåˆ†æ -->
                <div class="tab-content" id="tab4">
                    <h3>ä¼ ç»Ÿæ–¹å¼ vs. AIç³»ç»Ÿ æ•ˆç›Šå¯¹æ¯”</h3>
                    <div class="result-box">
                        <table>
                            <thead><tr><th>å¯¹æ¯”æŒ‡æ ‡</th><th>ä¼ ç»Ÿäººå·¥æ–¹å¼</th><th>æœ¬AIç³»ç»Ÿ</th><th>æå‡æ•ˆæœ</th></tr></thead>
                            <tbody>
                                <tr><td>æŠ¥ä»·å“åº”æ—¶é—´</td><td>4-6 å°æ—¶</td><td><span class="highlight">< 10 åˆ†é’Ÿ</span></td><td><span class="success">æ•ˆç‡æå‡çº¦30å€</span></td></tr>
                                <tr><td>æ‹†å›¾äººå·¥å‚ä¸</td><td>å·¥ç¨‹å¸ˆå…¨ç¨‹å¤„ç†</td><td>å·¥ç¨‹å¸ˆä»…å®¡æ ¸ä¼˜åŒ–</td><td><span class="success">å·¥ä½œé‡å‡å°‘70%</span></td></tr>
                                <tr><td>æ•°æ®å‡†ç¡®æ€§</td><td>ä¾èµ–ä¸ªäººç»éªŒï¼Œæ˜“å‡ºé”™</td><td>åŸºäºå…¨å‚å†å²æ•°æ®ï¼Œæ ‡å‡†åŒ–</td><td><span class="success">é”™è¯¯ç‡ä¸‹é™85%</span></td></tr>
                                <tr><td>è®¢å•è½¬åŒ–ç‡</td><td>å“åº”æ…¢ï¼Œå®¢æˆ·æ˜“æµå¤±</td><td>å¿«é€Ÿç²¾å‡†ï¼Œå¢å¼ºå®¢æˆ·ä¿¡å¿ƒ</td><td><span class="success">é¢„è®¡æå‡15%</span></td></tr>
                                <tr><td>ç®¡ç†æˆæœ¬</td><td>çº¸è´¨å›¾çº¸ï¼Œéš¾ä»¥æ£€ç´¢è¿½è¸ª</td><td>å…¨æ•°å­—åŒ–ï¼Œä¸€é”®è¿½æº¯</td><td><span class="success">ç®¡ç†æ•ˆç‡é£è·ƒ</span></td></tr>
                            </tbody>
                        </table>
                        <p style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                            <i class="fas fa-chart-bar"></i> <strong>æŠ•èµ„å›æŠ¥æµ‹ç®—</strong>ï¼šä»¥ä¼ä¸šå¹´å¤„ç†2000ä»½è®¢å•è®¡ï¼Œæœ¬ç³»ç»Ÿé¢„è®¡å¯èŠ‚çº¦å·¥ç¨‹å¸ˆå·¥æ—¶çº¦ <span class="highlight">3200å°æ—¶/å¹´</span>ï¼Œç›´æ¥ä¸é—´æ¥åˆ›é€ å¹´åŒ–ä»·å€¼è¶…è¿‡ <span class="highlight">50ä¸‡å…ƒ</span>ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <p>Â© 2024 åˆ›å…´ç²¾å¯†AIæ•°å­—åŒ–å°ç»„ | æœ¬æ¼”ç¤ºç³»ç»Ÿæ¨¡æ‹Ÿäº†AIå›¾çº¸è¯†åˆ«çš„å®Œæ•´ä¸šåŠ¡æµç¨‹ä¸ä»·å€¼äº§å‡º | ä»…ä¾›è¯¾ç¨‹ä½œä¸šæ±‡æŠ¥ä½¿ç”¨</p>
        </footer>
    </div>

    <script>
        // ============== å…¨å±€å˜é‡ä¸æ¨¡æ‹Ÿæ•°æ® ==============
        let fabricCanvas = null; // ç”¨äºå›¾çº¸æ ‡æ³¨çš„ç”»å¸ƒå¯¹è±¡
        // æ¨¡æ‹ŸAIåˆ†ææŠ¥å‘Š
        const sampleReport = {
            projectName: "ç”Ÿç‰©è´¨ç‡ƒçƒ§æœºå¤–å£³ç»„ä»¶",
            orderId: "ORD20250315",
            status: "âœ… åˆ†æå®Œæˆ",
            totalParts: 19,
            totalWeight: "â‰ˆ125kg",
            totalHours: "16 å°æ—¶",
            materialCost: "Â¥8,200",
            totalCost: "Â¥12,540",
            suggestion: "å»ºè®®ä¼˜å…ˆæ’äº§ï¼Œå…³é”®å·¥åºä¸ºæ¿€å…‰åˆ‡å‰²ä¸ç„Šæ¥ã€‚"
        };
        // æ¨¡æ‹Ÿé›¶ä»¶æ¸…å• (BOM)
        const sampleParts = [
            ["é¢æ¿-01", "Q235é’¢æ¿", "2.0mm", "500x300", "æ¿€å…‰åˆ‡å‰²", 2],
            ["ä¾§æ¿-02", "304ä¸é”ˆé’¢", "1.5mm", "200x150", "æ¿€å…‰åˆ‡å‰²â†’æŠ˜å¼¯", 4],
            ["æ”¯æ¶-03", "é•€é”Œæ¿", "3.0mm", "80x80", "å†²å‹", 12],
            ["åº•æ¿-04", "é“æ¿", "5.0mm", "1000x800", "æ¿€å…‰åˆ‡å‰²", 1],
            ["åŠ å¼ºç­‹-05", "Q235é’¢æ¿", "2.5mm", "450x40", "æ¿€å…‰åˆ‡å‰²â†’æŠ˜å¼¯", 8],
            ["è¿æ¥ç‰‡-06", "é•€é”Œæ¿", "1.2mm", "60x40", "å†²å‹", 24]
        ];
        // æ¨¡æ‹Ÿå›¾çº¸ä¸Šé›¶ä»¶æ¡†çš„æ•°æ®
        const partRectangles = [
            { id: 'part1', name: 'é¢æ¿-01', left: 50, top: 60, width: 200, height: 120, color: 'rgba(255, 50, 50, 0.3)' },
            { id: 'part2', name: 'ä¾§æ¿-02', left: 300, top: 80, width: 100, height: 180, color: 'rgba(50, 150, 255, 0.3)' },
            { id: 'part3', name: 'æ”¯æ¶-03', left: 150, top: 250, width: 80, height: 80, color: 'rgba(50, 255, 100, 0.3)' },
            { id: 'part4', name: 'åº•æ¿-04', left: 400, top: 300, width: 250, height: 150, color: 'rgba(255, 200, 50, 0.3)' },
        ];

        // ============== é€šç”¨ç•Œé¢åŠŸèƒ½å‡½æ•° ==============
        function switchTab(index) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.tab')[index].classList.add('active');
            document.querySelectorAll('.tab-content')[index].classList.add('active');
        }
        function updateStatus(message, type = 'info') {
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-info-circle';
            const colorClass = type === 'success' ? 'success' : '';
            document.getElementById('statusBar').innerHTML = `<i class="fas ${icon} ${colorClass}"></i> <span>${message}</span>`;
        }

        // ============== å›¾çº¸æ ‡æ³¨ä¸äº¤äº’åŠŸèƒ½ (æ ¸å¿ƒ) ==============
        function initDrawingCanvas(imageUrl) {
            const canvasEl = document.getElementById('drawingCanvas');
            fabricCanvas = new fabric.Canvas('drawingCanvas');
            // åŠ è½½ä¸Šä¼ çš„å›¾ç‰‡ä½œä¸ºç”»å¸ƒèƒŒæ™¯
            fabric.Image.fromURL(imageUrl, function(img) {
                const scale = Math.min(canvasEl.width / img.width, canvasEl.height / img.height, 1);
                img.scale(scale);
                fabricCanvas.setWidth(img.width * scale);
                fabricCanvas.setHeight(img.height * scale);
                fabricCanvas.setBackgroundImage(img, fabricCanvas.renderAll.bind(fabricCanvas));
                // åœ¨èƒŒæ™¯å›¾ä¸Šæ·»åŠ æ¨¡æ‹Ÿçš„é›¶ä»¶æ¡†
                addMockPartRectangles();
                // ç”Ÿæˆå³ä¾§çš„äº¤äº’é›¶ä»¶åˆ—è¡¨
                generatePartList();
            });
        }
        function addMockPartRectangles() {
            partRectangles.forEach(part => {
                const rect = new fabric.Rect({
                    left: part.left, top: part.top, fill: part.color,
                    width: part.width, height: part.height,
                    stroke: 'black', strokeWidth: 2, strokeDashArray: [5, 5],
                    selectable: false, hasControls: false, name: part.name, partId: part.id
                });
                const text = new fabric.Text(part.name, {
                    left: part.left + 5, top: part.top - 25,
                    fontSize: 16, fill: '#1a2980', fontWeight: 'bold', fontFamily: 'Arial'
                });
                fabricCanvas.add(rect, text);
            });
            fabricCanvas.renderAll();
        }
        function generatePartList() {
            const listContainer = document.getElementById('partList');
            listContainer.innerHTML = '';
            const partData = [
                { id: 'part1', name: 'é¢æ¿-01', desc: 'ä¸»ç»“æ„ä»¶ï¼Œæ¿€å…‰åˆ‡å‰²' },
                { id: 'part2', name: 'ä¾§æ¿-02', desc: 'æ”¯æ’‘ä»¶ï¼Œéœ€æŠ˜å¼¯' },
                { id: 'part3', name: 'æ”¯æ¶-03', desc: 'è¿æ¥ä»¶ï¼Œå†²å‹æˆå‹' },
                { id: 'part4', name: 'åº•æ¿-04', desc: 'æ‰¿è½½ä»¶ï¼Œæ•´ä½“åˆ‡å‰²' },
            ];
            partData.forEach(part => {
                const item = document.createElement('div');
                item.className = 'part-item';
                item.innerHTML = `<strong>${part.name}</strong><br><small>${part.desc}</small>`;
                item.onclick = () => highlightPart(part.id);
                listContainer.appendChild(item);
            });
        }
        function highlightPart(partId) {
            fabricCanvas.getObjects('rect').forEach(obj => {
                const original = partRectangles.find(p => p.id === obj.partId);
                if (original) obj.set({ fill: original.color, strokeWidth: 2 });
            });
            const target = fabricCanvas.getObjects('rect').find(obj => obj.partId === partId);
            if (target) {
                target.set({ fill: 'rgba(255, 0, 0, 0.6)', strokeWidth: 4 });
                fabricCanvas.renderAll();
            }
        }
        function resetHighlight() {
            fabricCanvas.getObjects('rect').forEach(obj => {
                const original = partRectangles.find(p => p.id === obj.partId);
                if (original) obj.set({ fill: original.color, strokeWidth: 2 });
            });
            fabricCanvas.renderAll();
        }
        function downloadMarkedDrawing() {
            const link = document.createElement('a');
            link.download = `AIæ‹†è§£å›¾çº¸_${sampleReport.orderId}.png`;
            link.href = fabricCanvas.toDataURL({ format: 'png', quality: 1.0 });
            link.click();
            updateStatus(`âœ… æ ‡æ³¨å›¾çº¸å·²ä¸‹è½½ï¼Œå¯ç”¨äºè½¦é—´ç”Ÿäº§æŒ‡å¯¼ã€‚`, 'success');
        }

        // ============== ä¸»æµç¨‹æ§åˆ¶å‡½æ•° ==============
        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').innerHTML = `<i class="fas fa-file"></i> å·²é€‰æ‹©ï¼š<strong>${file.name}</strong>`;
                updateStatus(`å·²å‡†å¤‡åˆ†ææ–‡ä»¶ï¼šâ€œ${file.name}â€ã€‚`, 'info');
            }
        });
        // æ ¸å¿ƒï¼šæ¨¡æ‹ŸAIåˆ†æå…¨è¿‡ç¨‹
        function startAnalysis() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files[0]) { alert("è¯·å…ˆä¸Šä¼ ä¸€å¼ å›¾çº¸æ–‡ä»¶ã€‚"); return; }
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            document.getElementById('loading').style.display = 'block';
            updateStatus('AIå¼•æ“å¯åŠ¨ï¼šæ­£åœ¨è¯†åˆ«å›¾çº¸ç‰¹å¾ã€æ‹†è§£é›¶ä»¶ã€åŒ¹é…å·¥è‰ºåº“...', 'info');
            // æ¨¡æ‹Ÿ3ç§’çš„AIå¤„ç†è¿‡ç¨‹
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                // 1. æ›´æ–°æ€»è§ˆæŠ¥å‘Š
                const reportHtml = `<ul>
                    <li><strong>é¡¹ç›®åç§°</strong>ï¼š${sampleReport.projectName}</li>
                    <li><strong>è®¢å•å·</strong>ï¼š${sampleReport.orderId}</li>
                    <li><strong>AIè¯†åˆ«çŠ¶æ€</strong>ï¼š<span class="success">${sampleReport.status}</span></li>
                    <li><strong>è¯†åˆ«é›¶ä»¶æ€»æ•°</strong>ï¼š<span class="highlight">${sampleReport.totalParts} ä¸ª</span></li>
                    <li><strong>æ€»é‡é‡ä¼°ç®—</strong>ï¼š${sampleReport.totalWeight}</li>
                    <li><strong>æ€»å·¥æ—¶ä¼°ç®—</strong>ï¼š${sampleReport.totalHours}</li>
                    <li><strong>ææ–™æˆæœ¬ä¼°ç®—</strong>ï¼š${sampleReport.materialCost}</li>
                    <li><strong>æ€»è®¡æˆæœ¬ï¼ˆææ–™+äººå·¥ï¼‰</strong>ï¼š<span class="highlight">${sampleReport.totalCost}</span></li>
                    <li><strong>AIç”Ÿäº§å»ºè®®</strong>ï¼š${sampleReport.suggestion}</li>
                </ul>`;
                document.getElementById('reportContent').innerHTML = reportHtml;
                // 2. æ›´æ–°é›¶ä»¶è¡¨æ ¼ (BOM)
                const tableBody = document.querySelector('#partsTable tbody');
                tableBody.innerHTML = '';
                sampleParts.forEach((part, idx) => {
                    const row = `<tr><td>${idx+1}</td><td>${part[0]}</td><td>${part[1]}</td><td>${part[2]}</td><td>${part[3]}</td><td>${part[4]}</td><td>${part[5]}</td></tr>`;
                    tableBody.innerHTML += row;
                });
                // 3. åˆå§‹åŒ–äº¤äº’å¼å›¾çº¸æ ‡æ³¨
                const imageUrl = URL.createObjectURL(fileInput.files[0]);
                if (typeof fabric !== 'undefined') {
                    setTimeout(() => initDrawingCanvas(imageUrl), 100);
                }
                // 4. åˆ‡æ¢åˆ°æŠ¥å‘Šé¡µå¹¶æ›´æ–°çŠ¶æ€
                switchTab(0);
                updateStatus(`âœ… åˆ†ææˆåŠŸï¼å…±è¯†åˆ«å‡º ${sampleReport.totalParts} ä¸ªé›¶ä»¶ï¼Œå·²ç”Ÿæˆå®Œæ•´BOMä¸å·¥è‰ºè·¯çº¿ã€‚`, 'success');
            }, 3000);
        }
        // é‡ç½®ç³»ç»Ÿ
        function resetAll() {
            document.getElementById('fileInput').value = '';
            document.getElementById('fileName').innerHTML = 'æœªé€‰æ‹©æ–‡ä»¶';
            document.getElementById('reportContent').innerHTML = '<p>æŠ¥å‘Šå°†åœ¨AIåˆ†æåç”Ÿæˆã€‚</p>';
            document.querySelector('#partsTable tbody').innerHTML = '<tr><td colspan="7" style="text-align:center;">æ•°æ®åŠ è½½ä¸­...</td></tr>';
            document.getElementById('loading').style.display = 'none';
            if (fabricCanvas) { fabricCanvas.dispose(); fabricCanvas = null; }
            document.getElementById('partList').innerHTML = '';
            updateStatus('ç³»ç»Ÿå·²é‡ç½®ã€‚è¯·ä¸Šä¼ å›¾çº¸å¹¶å¯åŠ¨åˆ†æã€‚', 'info');
            switchTab(0);
        }
        // é¡µé¢åˆå§‹åŒ–
        updateStatus('ç³»ç»Ÿå°±ç»ªã€‚è¯·ä¸Šä¼ å›¾çº¸å¹¶å¯åŠ¨åˆ†æã€‚', 'info');
    </script>
</body>
</html>